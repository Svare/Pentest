#!/usr/bin/python
# -*- coding: utf-8 -*-

import argparse
import subprocess
import re

def arg_parse():

    parser = argparse.ArgumentParser(description="ttl based OS Discovery",
                                        epilog="Developed by Jes√∫s Enrique Pacheco Franco [Svare]")
    
    parser.add_argument('-i', '--host', default = None, type=str, required=True, help='Host to scan.',
                            dest='host')

    return parser.parse_args()



if __name__ == '__main__':

    re_ttl = re.compile(r'ttl=(\d+)')
    
    opts = arg_parse()
    
    cmnd = subprocess.Popen(['ping', opts.host, '-c', '4'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    stdout,stderr = cmnd.communicate()

    num = re.search(re_ttl, stdout.decode("utf-8"))

    print('TTL: {0}'.format(int(num.groups()[0])))

    if int(num.groups()[0]) == 128:
        print('Posible Host\'s OS: Windows')
    elif int(num.groups()[0]) in [64, 66, 255]:
        print('Posible Host\'s OS: Linux')
    else:
        print('Unknown Host\'s OS no TTL match')