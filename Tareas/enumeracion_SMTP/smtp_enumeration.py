#!/usr/bin/python3

# Jesus Enrique Pacheco Franco
# 17/Abril/2019
# User Enumeration [SMTP]

import argparse, socket

def arg_parse():

    parser = argparse.ArgumentParser(description="User Enumeration [SMTP]", epilog="By Jesus E Pacheco F [Sv4r3]")

    parser.add_argument('-i', '--ip', default=None, type=str, required=True, dest='ip', help='IP Address.')
    parser.add_argument('-p', '--port', default=25, type=int, required=False, dest='port', help='SMTP Port.')
    parser.add_argument('-u', '--users', default=None, type=str, required=True, dest='users', help='User list file.')
    
    return parser.parse_args()

if __name__ == "__main__":

    opts = arg_parse()
    users = open(opts.users, 'r')

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    connect = s.connect((opts.ip, opts.port))

    print('\n' + s.recv(1024).decode('utf-8')) # Print Banner

    for user in users.readlines():
        s.send("VRFY ".encode() + user.strip().encode() + "\r\n".encode())
        if "User unknown" not in s.recv(1024).decode('utf-8'):
            print("{0:<15}[Exists]".format(user.strip()))
    
    print()

    users.close()
